{"ast":null,"code":"import * as actionTypes from './actionTypes';\nimport { getSongDetail, getSongPlayUrl, getLyric } from '@/service/player';\nimport { getRandomNumber } from '@/utils/math-utils';\nimport { parseLyric } from '@/utils/parse-lyric'; // 歌曲详情Action\n\nconst changeCurrentSongAction = res => ({\n  type: actionTypes.CHANGE_CURRENT_SONG,\n  currentSong: res\n}); // 当前歌曲索引Action\n\n\nconst changeSongIndexAction = res => ({\n  type: actionTypes.CHANGE_CURRENT_SONG_INDEX,\n  currentSongIndex: res\n}); // 歌曲列表Action\n\n\nconst changePlayListAction = res => ({\n  type: actionTypes.CHANGE_PLAY_LIST,\n  playList: res\n}); // 改变歌曲数量\n\n\nconst changePlayListCount = res => ({\n  type: actionTypes.CHANGE_PLAY_LIST_COUNT,\n  playListCount: res\n}); // 首次加载Action\n\n\nexport const changeFirstLoad = res => ({\n  type: actionTypes.CHANGE_FIRST_LOAD,\n  firstLoad: res\n}); // 获取歌曲详情\n\nexport const getSongDetailAction = id => {\n  return (dispatch, getState) => {\n    // 1、根据id查找palyList里是否有该歌曲\n    const playList = getState().player.playList;\n    const songIndex = playList.findIndex(song => song.id === id);\n\n    if (songIndex !== -1) {\n      // 2、找到歌曲\n      dispatch(changeSongIndexAction(songIndex));\n      dispatch(changeCurrentSongAction(playList[songIndex]));\n      dispatch(changeCurrentSongPlayUrlAction(id));\n      dispatch(getLyricAction(id));\n    } else {\n      // 3、没找到歌曲\n      // 请求数据\n      getSongDetail(id).then(res => {\n        const song = res.songs && res.songs[0];\n        playList.push(song); // (1)添加到播放列表中\n\n        dispatch(changePlayListAction(playList));\n        let songIndex = playList.length - 1; // (2)更改当前播放的索引\n\n        dispatch(changeSongIndexAction(songIndex)); // (3)更改当前播放歌曲\n\n        dispatch(changeCurrentSongAction(playList[songIndex])); // (4)更改当前播放歌曲url\n\n        dispatch(changeCurrentSongPlayUrlAction(id)); // (5)更新歌曲数量\n\n        dispatch(changePlayListCount(playList.length)); // (6)请求歌曲的歌词\n\n        dispatch(getLyricAction(id));\n      });\n    }\n  };\n}; // 歌曲音乐播放urlAction\n\nconst changeCurrentSongPlayUrlAction = res => ({\n  type: actionTypes.CHANGE_CURRENT_SONG_PLAY_URL,\n  currentSongPlayUrl: res.data && res.data[0]\n});\n\nexport const getSongPlayUrlAction = id => {\n  return dispatch => {\n    getSongPlayUrl(id).then(res => {\n      dispatch(changeCurrentSongPlayUrlAction(res));\n    });\n  };\n}; // 更改播放顺序Action\n\nexport const changePlaySequenceAction = res => ({\n  type: actionTypes.CHANGE_PLAY_SEQUENCE,\n  playSequence: res\n}); // 切换歌曲Action\n\nexport const changeCurrentIndexAndSongAction = tag => {\n  return (dispatch, getState) => {\n    // 根据playSequence决定是顺序播放还是随机播放\n    const playSequence = getState().player.playSequence; // 播放列表\n\n    const playList = getState().player.playList; // 当前播放的索引/下标\n\n    let currentSongIndex = getState().player.currentSongIndex; // 根据播放顺序选择下一首音乐\n\n    switch (playSequence) {\n      case 1:\n        // 随机播放\n        let random = getRandomNumber(playList.length);\n\n        while (random === currentSongIndex) {\n          random = getRandomNumber(playList.length);\n        } // 更改当前播放音乐的下标\n\n\n        currentSongIndex = random;\n        break;\n\n      default:\n        // 顺序播放\n        currentSongIndex += tag; // 判断当前音乐的下标是否超出播放列表长度\n\n        if (currentSongIndex >= playList.length) currentSongIndex = 0;\n        if (currentSongIndex < 0) currentSongIndex = playList.length - 1;\n    } // 获取需要播放的音乐\n\n\n    const song = playList[currentSongIndex]; // 更改当前播放的音乐\n\n    dispatch(changeCurrentSongAction(song));\n    dispatch(changeSongIndexAction(currentSongIndex));\n    dispatch(changeCurrentSongPlayUrlAction(song.id)); // 请求歌曲的歌词\n\n    dispatch(getLyricAction(song.id));\n  };\n}; // 改变歌词Action\n\nconst changeLyricAction = res => ({\n  type: actionTypes.CHANGE_LYRIC_LIST,\n  lyricList: res\n}); // 请求歌词\n\n\nexport const getLyricAction = id => {\n  return async dispatch => {\n    await getLyric(id).then(res => {\n      const lyric = res.lrc && res.lrc.lyric;\n      const lyricList = parseLyric(lyric);\n      dispatch(changeLyricAction(lyricList));\n    });\n  };\n}; // 改变currentLyricIndex\n\nexport const changeCurrentLyricIndexAction = res => ({\n  type: actionTypes.CHANGE_CURRENT_LYRIC_INDEX,\n  currentLyricIndex: res\n}); // 修改播放列表并修改歌曲数量\n\nexport const changePlaylistAndCount = playlist => {\n  return dispatch => {\n    dispatch(changePlayListAction(playlist));\n    dispatch(changePlayListCount(playlist.length));\n  };\n}; // 改变歌曲播放状态\n\nexport const changeIsPlayingAction = res => ({\n  type: actionTypes.CHANGE_ISPLAYING,\n  isPlaying: res\n});","map":{"version":3,"sources":["/Users/jr/myWeb/React项目实战/music163_jr/src/pages/player/store/actionCreator.js"],"names":["actionTypes","getSongDetail","getSongPlayUrl","getLyric","getRandomNumber","parseLyric","changeCurrentSongAction","res","type","CHANGE_CURRENT_SONG","currentSong","changeSongIndexAction","CHANGE_CURRENT_SONG_INDEX","currentSongIndex","changePlayListAction","CHANGE_PLAY_LIST","playList","changePlayListCount","CHANGE_PLAY_LIST_COUNT","playListCount","changeFirstLoad","CHANGE_FIRST_LOAD","firstLoad","getSongDetailAction","id","dispatch","getState","player","songIndex","findIndex","song","changeCurrentSongPlayUrlAction","getLyricAction","then","songs","push","length","CHANGE_CURRENT_SONG_PLAY_URL","currentSongPlayUrl","data","getSongPlayUrlAction","changePlaySequenceAction","CHANGE_PLAY_SEQUENCE","playSequence","changeCurrentIndexAndSongAction","tag","random","changeLyricAction","CHANGE_LYRIC_LIST","lyricList","lyric","lrc","changeCurrentLyricIndexAction","CHANGE_CURRENT_LYRIC_INDEX","currentLyricIndex","changePlaylistAndCount","playlist","changeIsPlayingAction","CHANGE_ISPLAYING","isPlaying"],"mappings":"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","sourcesContent":["import * as actionTypes from './actionTypes';\nimport {getSongDetail,\n        getSongPlayUrl,\n        getLyric} from '@/service/player';\nimport { getRandomNumber } from '@/utils/math-utils'\nimport { parseLyric } from '@/utils/parse-lyric'\n\n// 歌曲详情Action\nconst changeCurrentSongAction = res =>({\n    type:actionTypes.CHANGE_CURRENT_SONG,\n    currentSong:res\n})\n// 当前歌曲索引Action\nconst changeSongIndexAction = res =>({\n    type:actionTypes.CHANGE_CURRENT_SONG_INDEX,\n    currentSongIndex:res\n})\n// 歌曲列表Action\nconst changePlayListAction = res =>({\n    type:actionTypes.CHANGE_PLAY_LIST,\n    playList:res\n})\n\n// 改变歌曲数量\nconst changePlayListCount = res => ({\n    type: actionTypes.CHANGE_PLAY_LIST_COUNT,\n    playListCount:res\n})\n\n\n// 首次加载Action\nexport const changeFirstLoad = res => ({\n    type: actionTypes.CHANGE_FIRST_LOAD,\n    firstLoad: res\n})\n\n// 获取歌曲详情\nexport const getSongDetailAction = (id) =>{\n    return (dispatch,getState) => {\n        // 1、根据id查找palyList里是否有该歌曲\n        const playList = getState().player.playList;\n        const songIndex = playList.findIndex(song => song.id===id);\n        \n        if(songIndex !== -1){\n            // 2、找到歌曲\n            dispatch(changeSongIndexAction(songIndex));\n            dispatch(changeCurrentSongAction(playList[songIndex]));\n            dispatch(changeCurrentSongPlayUrlAction(id));\n            dispatch(getLyricAction(id))\n\n        }else{\n            // 3、没找到歌曲\n            // 请求数据\n            getSongDetail(id).then(res => {\n                const song = res.songs && res.songs[0];\n                playList.push(song);\n                // (1)添加到播放列表中\n                dispatch(changePlayListAction(playList));\n                let songIndex = playList.length-1;\n                // (2)更改当前播放的索引\n                dispatch(changeSongIndexAction(songIndex));\n                // (3)更改当前播放歌曲\n                dispatch(changeCurrentSongAction(playList[songIndex]));\n                // (4)更改当前播放歌曲url\n                dispatch(changeCurrentSongPlayUrlAction(id));\n                // (5)更新歌曲数量\n                dispatch(changePlayListCount(playList.length));\n                // (6)请求歌曲的歌词\n                dispatch(getLyricAction(id))\n            });\n\n        }\n    }\n}\n\n// 歌曲音乐播放urlAction\nconst changeCurrentSongPlayUrlAction = res => ({\n    type:actionTypes.CHANGE_CURRENT_SONG_PLAY_URL,\n    currentSongPlayUrl:res.data && res.data[0]\n})\n\nexport const getSongPlayUrlAction = id =>{\n    return dispatch => {\n        getSongPlayUrl(id).then((res) => {\n            dispatch(changeCurrentSongPlayUrlAction(res));\n        });\n    }\n}\n\n// 更改播放顺序Action\nexport const changePlaySequenceAction = (res) => ({\n    type: actionTypes.CHANGE_PLAY_SEQUENCE,\n    playSequence:res\n})\n\n// 切换歌曲Action\nexport const changeCurrentIndexAndSongAction = (tag) =>{\n    return (dispatch,getState) => {\n        // 根据playSequence决定是顺序播放还是随机播放\n        const playSequence = getState().player.playSequence;\n        // 播放列表\n        const playList = getState().player.playList;\n        // 当前播放的索引/下标\n        let currentSongIndex = getState().player.currentSongIndex;\n\n        // 根据播放顺序选择下一首音乐\n        switch(playSequence){\n            case 1: \n                // 随机播放\n                let random = getRandomNumber(playList.length)\n                while (random === currentSongIndex) {\n                    random = getRandomNumber(playList.length)\n                }\n                // 更改当前播放音乐的下标\n                currentSongIndex = random\n                break;\n            default:\n                // 顺序播放\n                currentSongIndex += tag\n                // 判断当前音乐的下标是否超出播放列表长度\n                if (currentSongIndex >= playList.length) currentSongIndex = 0;\n                if (currentSongIndex < 0) currentSongIndex = playList.length - 1;\n        }\n        // 获取需要播放的音乐\n        const song = playList[currentSongIndex];\n        // 更改当前播放的音乐\n        dispatch(changeCurrentSongAction(song));\n        dispatch(changeSongIndexAction(currentSongIndex))\n        dispatch(changeCurrentSongPlayUrlAction(song.id));\n        // 请求歌曲的歌词\n        dispatch(getLyricAction(song.id))\n    }\n}\n\n// 改变歌词Action\nconst changeLyricAction = (res) => ({\n    type: actionTypes.CHANGE_LYRIC_LIST,\n    lyricList:res\n})\n\n// 请求歌词\nexport const getLyricAction = (id) => {\n    return async (dispatch) => {\n      await getLyric(id).then((res) => {\n        const lyric = res.lrc && res.lrc.lyric\n        const lyricList = parseLyric(lyric)\n    \n        dispatch(changeLyricAction(lyricList))\n      })\n    }\n  }\n\n\n// 改变currentLyricIndex\nexport const changeCurrentLyricIndexAction = (res) => ({\n    type: actionTypes.CHANGE_CURRENT_LYRIC_INDEX,\n    currentLyricIndex:res\n})\n\n// 修改播放列表并修改歌曲数量\nexport const changePlaylistAndCount = (playlist) => {\n    return (dispatch) => {\n      dispatch(changePlayListAction(playlist))\n      dispatch(changePlayListCount(playlist.length))\n    }\n}\n\n// 改变歌曲播放状态\nexport const changeIsPlayingAction = (res) => ({\n    type: actionTypes.CHANGE_ISPLAYING,\n    isPlaying:res\n})\n\n\n"]},"metadata":{},"sourceType":"module"}