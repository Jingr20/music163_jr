### ä¸€ã€é¡¹ç›®åˆå§‹åŒ–

- ä½¿ç”¨`create-react-app`è„šæ‰‹æ¶åˆå§‹åŒ–é¡¹ç›®ç»“æ„: `create-react-app music163_jr`

  åº•å±‚åŸºäºwebpack

- ç›®å½•ç»“æ„

  ```
  â”‚â”€src
    â”œâ”€assets å­˜æ”¾å…¬å…±èµ„æºcsså’Œå›¾ç‰‡
      â”œâ”€css  å…¨å±€css
      â”œâ”€img  
    â”œâ”€common  å…¬å…±çš„ä¸€äº›å¸¸é‡
    â”œâ”€components å…¬å…±ç»„ä»¶
    â”œâ”€pages   è·¯ç”±æ˜ å°„ç»„ä»¶
    â”œâ”€router  å‰ç«¯è·¯ç”±é…ç½®
    â”œâ”€service ç½‘ç»œé…ç½®å’Œè¯·æ±‚
    â””â”€store   å…¨å±€çš„storeé…ç½®
    â””â”€utils   å·¥å…·å‡½æ•°
    â””â”€hooks   è‡ªå®šä¹‰hook
  ```

### äºŒã€é¡¹ç›®æ ·å¼é€‰æ‹©

- æ ·å¼é‡ç½®

  normalize.cssï¼šå¯¹HTMLå…ƒç´ å‡ ä¹æ‰€æœ‰çš„é»˜è®¤æ ·å¼è¿›è¡Œé‡ç½®ï¼Œè®©æ‰€æœ‰çš„æµè§ˆå™¨ä¸Šå¯¹äºæœªå®šä¹‰çš„æ ·å¼æµè§ˆæ•ˆæœè¾¾åˆ°ä¸€è‡´

  å®‰è£…    `npm i -s  normalize.css`

- é¡¹ç›®èµ„æº

  æ”¾åœ¨src/assets/img/ä¸‹ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„ç²¾çµå›¾å’ŒèƒŒæ™¯å›¾

- å…¨å±€CSSæ–‡ä»¶

  src/assets/css/reset.css

  - å¯¼å…¥normalize.css
  - å®šä¹‰ç²¾çµå›¾èƒŒæ™¯ï¼ˆç²¾çµå›¾çš„ç±»åæ˜¯å¯¹åº”çš„å›¾ç‰‡æ–‡ä»¶åï¼‰

### ä¸‰ã€é¡¹ç›®é…ç½®

ä½¿ç”¨cracoï¼ˆä½¿ç”¨reactæ‰‹è„šæ¶æ­å»ºé¡¹ç›®ï¼Œwebpackè¢«å°è£…ï¼‰

- å¯¹é¡¹ç›®ä¸­ wepback è¿›è¡Œè‡ªå®šä¹‰é…ç½®
- é…ç½®è·¯å¾„åˆ«å

1. å®‰è£…

   `npm i -s @craco/craco`

2. ä¿®æ”¹`package.json`æ–‡ä»¶

   - åŸæœ¬å¯åŠ¨æ—¶ï¼Œé€šè¿‡`react-scripts`æ¥ç®¡ç†çš„ï¼›
   - ç°åœ¨å¯åŠ¨æ—¶ï¼Œé€šè¿‡`craco`æ¥ç®¡ç†ï¼›

   ```json
   "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
   
    "start": "craco start",
    "build": "craco build",
    "test": "craco test",
   }
   ```

3. åœ¨**æ ¹ç›®å½•ä¸‹**åˆ›å»º `craco.config.js` æ–‡ä»¶ç”¨äºä¿®æ”¹é»˜è®¤é…ç½®

   ç±»ä¼¼webpack.config.js

   - `module.exports = { // é…ç½®æ–‡ä»¶ }`

   ```javascript
   // æ ¹è·¯å¾„ -> craco.config.js
   const path = require('path')
   const resolve = dir => path.resolve(__dirname, dir)
   
   module.exports = {
     webpack: {
       alias: {
          // @æ˜ å°„srcè·¯å¾„
         '@': resolve('src'),
         'components': resolve('src/components')
       }
     }
   }
   ```

### å››ã€ç»„ä»¶åˆ’åˆ†

#### 1ã€headerç»„ä»¶

- çŠ¶æ€ï¼šå›ºå®šï¼Œä¸ä¼šéšç€URLå‘ç”Ÿå˜åŒ–
- ç»„ä»¶å­˜æ”¾ï¼šsrc/components/app-headeræ–‡ä»¶å¤¹ä¸­



#### 2ã€footerç»„ä»¶

- çŠ¶æ€ï¼šå›ºå®šï¼Œä¸ä¼šéšç€URLå‘ç”Ÿå˜åŒ–
- ç»„ä»¶å­˜æ”¾ï¼šsrc/components/app-footeræ–‡ä»¶å¤¹ä¸­



#### 3ã€mainä¸»ä½“å†…å®¹

- **çŠ¶æ€**ï¼š **ä¸»ä½“å†…å®¹ä¼šæ˜¯éšç€è·¯å¾„å˜åŒ–åŠ¨æ€çš„å‘ç”Ÿæ”¹å˜çš„**

- ä½¿ç”¨`router`åŠ¨æ€æ¸²æŸ“`path`å¯¹åº”çš„ç»„ä»¶ï¼Œå…·ä½“é…ç½®å¦‚ä¸‹

  - å‰æï¼š åœ¨`src/pages`æ–‡ä»¶å¤¹æœ‰åˆ›å»º`discoverå’Œmineå’Œfriend`ç»„ä»¶

1. å®‰è£…`router`ï¼š`npm i -s react-router-dom`
2. å®‰è£…`react-router-config`(é›†ä¸­å¼é…ç½®è·¯ç”±æ˜ å°„):`npm i -s react-router-config`

```javascript
// src/router->index.js  (é…ç½®è·¯ç”±æ˜ å°„)
import Discover from "@/pages/discover";
import Mine from "@/pages/mine";
import Friend from "@/pages/friend";

const routes = [
  {
    path: "/discover",
    component: Discover    
  },
  {
    path: "/mine",
    component: Mine
  },
  {
    path: "/friend",
    component: Friend
  },
];

export default routes;
```

3. åœ¨`App.js`ä½¿ç”¨`HashRouter`ç»„ä»¶åŒ…è£¹ä½¿ç”¨`router-config`é…ç½®çš„è·¯ç”±æ˜ å°„ï¼ˆä½¿è·¯ç”±æ˜ å°„è¡¨çš„é…ç½®ç”Ÿæ•ˆ):

```javascript
import {HashRouter} from 'react-router-dom';
import {renderRoutes} from 'react-router-config';
import routes from '@/router';
import AppHeader from 'components/app-header';
function App() {
  return (
    <div className="App">
      <HashRouter>
        <AppHeader />
        {renderRoutes(routes)}
      </HashRouter>
    </div>
  );
}

export default App;
```

- **éªŒè¯è·¯ç”±æ˜¯å¦é…ç½®æˆåŠŸ**ï¼šåœ¨`header`ç»„ä»¶ä¸­ï¼Œä½¿ç”¨`NavLink`æµ‹è¯•è·¯å¾„åˆ‡æ¢ï¼Œæ¸²æŸ“å¯¹åº”ç»„ä»¶

  

### äº”ã€headerç»„ä»¶å®ç°

#### 1ã€å¤´éƒ¨ç»„ä»¶æ ·å¼ç¼–å†™

- åˆ©ç”¨`styled-components`åº“é€‰æ‹©CSS-IN-JSçš„è§£å†³æ–¹æ¡ˆ

- å®‰è£…ï¼š`npm i -s styled-component`

- å¸ƒå±€ä½¿ç”¨`flex`

#### 2ã€å¤´éƒ¨åŒºåŸŸåˆ’åˆ†

- å·¦å¯¼èˆª + å³å…¶å®ƒ

<img src='./images/3.png'>


#### 3ã€å¤´éƒ¨åŒºåŸŸå®ç°(å·¦)

```
å®ç°åŠŸèƒ½ï¼šç‚¹å‡»å¤´éƒ¨åˆ—è¡¨é¡¹ï¼Œæ·»åŠ èƒŒæ™¯é«˜äº®å’Œä¸‹é¢çš„å°ä¸‰è§’
å®ç°æ€è·¯ï¼š
- (åˆ©ç”¨`NavLink`ç»„ä»¶çš„`activeClassName`å•ç‹¬è®¾ç½®æ ·å¼)
- hotå°å›¾æ ‡åœ¨æœ€åä¸€ä¸ªå¯¼èˆªæ ‡ç­¾ä¸Šæ·»åŠ ä¼ªå…ƒç´ å®ç°
```

- å¤´éƒ¨å¯¼èˆªå†…å®¹å›ºå®šï¼Œå­˜å‚¨åœ¨src/common/local-data.jsä¸­ï¼Œä»¥`headerLinks`æ•°ç»„å½¢å¼å¯¼å‡º

  ```javascript
  export const headerLinks = [
    {
      title: 'å‘ç°éŸ³ä¹',
      link: '/discover', //ç‚¹å‡»routeråŠ¨æ€æ¸²æŸ“ç»„ä»¶
    },
    ...
   ]
  ```

<img src='./images/1.png'>

#### 4ã€å¤´éƒ¨åŒºåŸŸå®ç°(å³)

- å³ä¾§ä½¿ç”¨`Antd`ç»„ä»¶åº“å®ç°
- å®‰è£…ï¼š`npm i -s antd`   `npm i -s @ant-design/icons`

```
1.åœ¨reset.cssæ–‡ä»¶å¼•å…¥: antdæ ·å¼ â†“
    @import '~antd/dist/antd.css';
2.åœ¨Header.jså¼•å…¥icons
3.ä½¿ç”¨antdç»„ä»¶: Inputç»„ä»¶
4.ä¿®æ”¹placeholdæ–‡æœ¬æ ·å¼
```

<img src='./images/2.png'>

### å…­ã€footerç»„ä»¶å®ç°

#### 1ã€åº•éƒ¨åŒºåŸŸå¸ƒå±€

<img src='./images/5.png'>

#### 2ã€å®ç°æ•ˆæœ

<img src='./images/4.png'>

### ä¸ƒã€è·¯ç”±ä¼˜åŒ–å’ŒAPIè¯´æ˜

#### 1ã€é¡¹ç›®æ¥å£

- æœ¬åœ°å®‰è£…éƒ¨ç½²ï¼Œå¯åŠ¨nodeæœåŠ¡ï¼Œç«¯å£4000

- å®˜ç½‘æœ‰è¯¦ç»†çš„æ¥å£æ–‡æ¡£è¯´æ˜   `https://binaryify.github.io/NeteaseCloudMusicApi/#/?id=æ¥å£æ–‡æ¡£`

  ```
  git clone https://github.com/Binaryify/NeteaseCloudMusicApi.git
  cd NeteaseCloudMusicApi
  npm install
  npm start // å¯åŠ¨æœåŠ¡
  ```

#### 2ã€è·¯ç”±ä¼˜åŒ–_é‡å®šå‘

- å¯¹'æ ¹è·¯ç”±'è¿›è¡Œé‡å®šå‘åˆ°: `discover`é¡µé¢

  ```javascript
  const routes = [
      ...
      {
          path: '/', 
          exact: true, 
          render: () => <Redirect to="/discover" /> 
      }
      // {
      //     path:"/",
      //     component:Discover
      // }
  
  ]
  ```

#### 3ã€åµŒå¥—è·¯ç”±

é’ˆå¯¹discoveré¡µé¢ä¸‹çš„å­å¯¼èˆªæ 

- åˆ›å»ºdiscoveræ–‡ä»¶å¤¹ä¸‹çš„å­ç»„ä»¶

  <img src='./images/6.png' width="300">

- é…ç½®"åµŒå¥—è·¯ç”±æ˜ å°„è¡¨"

  ```javascript
  const routes = [
      {
          path:"/discover",
          component:Discover,
          routes:[
              { path: '/discover', exact:true, render: () => <Redirect to="/discover/recommend"/>},
              { path: '/discover/recommend', component: Recommend },
              { path: '/discover/ranking', component: Ranking },
              { path: '/discover/album', component: Album },
              { path: '/discover/djradio', component: Djradio },
              { path: '/discover/artist', component: Artist },
              { path: '/discover/song', component: Song }
          ]
      },
      ...
  ]   
  ```

- æ¸²æŸ“åµŒå¥—å­è·¯ç”±config

  - å­å¯¼èˆªæ çš„å®ç°

    - componentsä¸‹ç¼–å†™nav-barç»„ä»¶ï¼Œæ•°æ®å­˜å‚¨åœ¨local-data.jsä¸­
    - `discover`ç»„ä»¶ä¸­å¼•å…¥`navbar`ç»„ä»¶

    <img src='./images/7.png'>

  - åœ¨`discover`é¡µé¢ä¸‹æ¸²æŸ“åµŒå¥—å­è·¯ç”±

    ```javascript
    import {renderRoutes} from 'react-router-config';
    import NavBar from 'components/nav-bar';
    
    function Discover(props){
        return (
            <div>
                <NavBar />
                {renderRoutes(props.routes)}
            </div>
        );
    }
    
    export default Discover;
    ```

#### 4ã€è½®æ’­å›¾API

- å‘é€ç½‘ç»œè¯·æ±‚ä½¿ç”¨`axios`

- å®‰è£…axios:`npm i -s axios`

- äºŒæ¬¡å°è£…axios

  - apiç»Ÿä¸€ç®¡ç†ï¼Œå®¹æ˜“ç»´æŠ¤

  - æ”¾åœ¨src/serviceä¸‹

  - ç®€æ˜“ç‰ˆ

    ```javascript
    import axios from 'axios'
    import { BASE_URL, TIMEOUT } from './config'
    
    const instance = axios.create({
      // é»˜è®¤çš„é…ç½®
      baseURL: BASE_URL, // -> http://123.57.176.198:3000/banner
      timeout: TIMEOUT, // -> 5000
      headers: {}
    })
    
    instance.interceptors.request.use(
      // è¯·æ±‚æ‹¦æˆª
      (config) => {
        return config
      },
      (err) => {}
    )
    
    instance.interceptors.response.use(
      // å“åº”æ‹¦æˆª
      (res) => {
        return res.data
      },
      (err) => {
        if (err && err.response) {
          switch (err.response.status) {
            case 400:
              console.log('è¯·æ±‚é”™è¯¯')
              break
            case 401:
              console.log('æœªæˆæƒè®¿é—®')
              break
            default:
              console.log('å…¶ä»–é”™è¯¯ä¿¡æ¯')
          }
        }
        return err
      }
    )
    
    export default instance
    ```

- è½®æ’­å›¾æ•°æ®è¯·æ±‚ä¸¾ä¾‹

  URLï¼šhttp://localhost:4000/banner

### å…«ã€reduxä¿å­˜æœåŠ¡å™¨è¿”å›çš„æ•°æ®

#### 1ã€å®‰è£…redux

- å®‰è£…   `npm i -s redux react-redux redux-thunk`

#### 2ã€é…ç½®redux

- é¡¹ç›®æ ¹ç›®å½•srcä¸‹çš„store â†’ reducer.js

  ```javascript
  import { combineReducers } from "redux";
  // å¼•å…¥recommendé¡µé¢çš„store
  import { reducer as recommendReducer } from '@/pages/discover/child-pages/recommend/store'
  
  // å°†å¤šä¸ªreduceråˆå¹¶
  const cReducer = combineReducers({
    recommend: recommendReducer
  })
  export default cReducer
  ```

- é¡¹ç›®æ ¹srcä¸‹store â†’ index.js

  ```javascript
  import { createStore,applyMiddleware } from "redux";
  
  // å¼•å…¥thunkä¸­é—´ä»¶(å¯ä»¥è®©æ´¾å‘çš„actionå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°)
  import thunk from 'redux-thunk'
  
  // å¼•å…¥åˆå¹¶åçš„reducer
  import cReducer from "./reducer";
  
  // åˆ›å»ºstoreå¹¶ä¼ é€’
  const store = createStore(cReducer,applyMiddleware(thunk))
  
  export default store
  ```

- é¡¹ç›®æ ¹srcç›®å½•ä¸‹app.jsæ–‡ä»¶ä¸­ â†’ é…ç½®react-redux

  ```javascript
  import {HashRouter} from 'react-router-dom';
  import {renderRoutes} from 'react-router-config';
  import routes from '@/router';
  import AppHeader from 'components/app-header';
  import AppFooter from 'components/app-footer';
  
  import {Provider} from 'react-redux';
  import store from './store';
  
  function App() {
    return (
      <Provider store={store}>
        <HashRouter>
          <AppHeader />
          {/* Routerè·¯ç”±æ˜ å°„ï¼ŒåŠ¨æ€æ¸²æŸ“ç»„ä»¶ */}
          {renderRoutes(routes)}
          <AppFooter />
        </HashRouter>
      </Provider>
    );
  }
  
  export default App;
  ```

- æ€»ç»“

  - å¼‚æ­¥æ“ä½œäº¤ç»™ä¸­é—´ä»¶å®ç°ï¼Œå°†actionæ‹¦æˆªä¸‹æ¥å®Œæˆä¸€äº›æ“ä½œåå†äº¤ç»™store

    ä¸­é—´ä»¶æ˜¯ä¸ªå‡½æ•°ï¼Œæ ¸å¿ƒæ˜¯å¯¹æ•°æ®è¿›è¡Œæ“ä½œ

  - thunkâ€”â€”ä¸­é—´ä»¶ï¼ˆå·¥å…·åŒ…ï¼‰ï¼Œé‡Œé¢å®Œæˆå¼‚æ­¥è¡Œä¸ºï¼ˆå‘é€è¯·æ±‚åŠ è½½æ•°æ®ç­‰ï¼‰
  
    ä½¿ç”¨äº†thunkï¼Œactioné‡Œé¢å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸ä¸€å®šæ˜¯å¯¹è±¡{type:,payload}

#### 3ã€è½®æ’­å›¾æ•°æ®é€šè¿‡redux-thunkæ¥è¯·æ±‚

- src->page->discover->child-pages->recommend->store->actionCreator.js (æ´¾å‘actionç”¨çš„)

  ```javascript
  import * as actionTypes from './actionTypes';
  import {getTopBanners} from '@/service/recommend';
  
  // è½®æ’­å›¾Action
  export const changeTopBannerAction = res => ({
      type: actionTypes.CHANGE_TOP_BANNER,
      topBanners: res,
  })
  
  // è½®æ’­å›¾ç½‘ç»œè¯·æ±‚
  export const getTopBannersAction = () => {
      return dispatch => {
        // å‘é€ç½‘ç»œè¯·æ±‚
          getTopBanners().then(res => {
              dispatch(changeTopBannerAction(res))
          })
      }
  }
  ```

- src/service->recommend.js-----------æ¨èé¡µçš„è½®æ’­å›¾APIæ¥å£

  ```javascript
  import request from './request';
  
  // è½®æ’­å›¾
  export function getTopBanners() {
      return request({
        url: "/banner"
      })
  }
  ```

- src/page->dicover->child-pages->recommend/index.js

  ```javascript
  import {getTopBannersAction} from './store/actionCreator';
  import {bindActionCreators} from 'redux';
  import {connect} from 'react-redux';
  import {Component} from 'react'
  
  class Recommend extends Component{
  
      render(){
          console.log('æ¸²æŸ“ç»„ä»¶Recommend');
          return (
              <div>
                  <div>recommend</div>
                  <div>{this.props.topBanners.length}</div>
              </div>
          );
      }
  
      componentDidMount(){
          console.log('Recommendç»„ä»¶æŒ‚è½½å®Œæˆäº†');
          this.props.getTopBannersAction();
      }
  
  
  }
  
  // function Recommend(props){
  //     console.log(props.topBanners);
  //     return (
  //         <div>
  //             <div>recommend</div>
  //             <div>{props.topBanners.length}</div>
  //             <button onClick={props.getTopBannersAction}>è·å–è½®æ’­å›¾</button>
  //         </div>
  //     );
  // }
  
  // ä»stateä¸­å–æ•°æ®æ˜ å°„åˆ°propsä¸Š
  const mapStateToProps = (state) => ({
      topBanners:state.recommend.topBanners
  })
  
  const mapDispatchToProps = (dispatch)=>(bindActionCreators({getTopBannersAction},dispatch))
  
  export default connect(mapStateToProps,mapDispatchToProps)(Recommend);
  ```

- æ•ˆæœ

  <img src='./images/8.png'>

#### ã€å‘ä¸€ã€‘

ä¸å°å¿ƒå†™äº†ä¸ªæ­»å¾ªç¯ï¼Œåœ¨renderé‡Œç›´æ¥ `this.props.getTopBannersAction();`ï¼Œæ•°æ®æ›´æ–°è§¦å‘renderï¼Œrenderé‡Œå†æ¬¡æ•°æ®æ›´æ–°

åˆæ¬¡æ•°æ®è¯·æ±‚æ”¾åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•° `componentDidMount`é‡Œ

#### ã€ç»„ä»¶å†…çŠ¶æ€ä½¿ç”¨react hookå®ç°ã€‘

#### ã€ä½¿ç”¨useSelectorã€useDispatchæ›¿ä»£connectã€‘

- redux äº§ç”Ÿçš„åŸå› æ˜¯å› ä¸ºä¸åŒç»„ä»¶éœ€è¦å®ç° state å…±äº«ï¼Œå…¨éƒ¨å­˜å‚¨åœ¨storeä¸­ç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºç»„ä»¶é—´é€šä¿¡
- æœ‰äº›åœºæ™¯ä¸å¿…ä½¿ç”¨åˆ°redux
- hooksåœ¨å‡½æ•°ç»„ä»¶ä¸­å¼•å…¥ç±»ç»„ä»¶ä¸­çš„çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸï¼Œå¤ç”¨ç»„ä»¶é€»è¾‘
- https://www.cnblogs.com/hymenhan/archive/2021/04/28/14711516.html

#### 4ã€useSelectoræ€§èƒ½ä¼˜åŒ–

```javascript
		const { topBanners } = useSelector(
        state => ({
            topBanners:state.recommend.topBanners
        }),
        shallowEqual
    )
```

- storeä¸­çš„stateå‘ç”Ÿå˜åŒ–ï¼Œä¼šè§¦å‘useSelector
- useSelectorå‡½æ•°é»˜è®¤ä¸å‰ä¸€æ¬¡è°ƒç”¨ä¸­è¿”å›çš„`state`å¯¹è±¡è¿›è¡Œä¸€æ¬¡å¼•ç”¨å¯¹æ¯”ï¼ˆ===ï¼‰ã€‚å› ä¸ºæ¯æ¬¡è°ƒç”¨å‡½æ•°çš„æ—¶å€™, åˆ›å»ºçš„å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªå…¨æ–°å¯¹è±¡ï¼Œæ‰€ä»¥æ¯æ¬¡åªè¦`storeä¸­çš„state`å‘ç”Ÿäº†æ”¹å˜, ä¸ç®¡å½“å‰ç»„ä»¶çš„ä¾èµ–å€¼æ˜¯å¦å˜åŒ–ï¼Œéƒ½ä¼šé‡æ–°æ¸²æŸ“
- shallowEqualï¼šæ¯”è¾ƒæ—¶è¿›è¡Œå€¼æ¯”è¾ƒ



### ä¹ã€æ¨èé¡µbanner

#### 1ã€è½®æ’­å›¾åŒºåŸŸå¸ƒå±€

<img src='./images/10.png'>

#### 2ã€è½®æ’­å›¾é‡‡ç”¨antdèµ°é©¬ç¯ç»„ä»¶

```javascript
import React, { useEffect, useRef, useState } from 'react';
import { shallowEqual, useDispatch, useSelector } from 'react-redux';
import { getTopBannersAction } from '../../store/actionCreator'
import {BannerWrapper,BannerLeft,BannerRight,BannerControl} from './style';
import {Carousel} from 'antd';

function TopBanners(){
    console.log('TopBannerç»„ä»¶æ¸²æŸ“äº†');

    // ç»„ä»¶å†…state
    const [currentIndex, setCurrentIndex] = useState(0)

    // redux Hook ç»„ä»¶å’Œreduxå…³è”: è·å–æ•°æ®å’Œè¿›è¡Œæ“ä½œ
    const dispatch = useDispatch()
    const { topBanners } = useSelector(
        state => ({
            topBanners:state.recommend.topBanners
        }),
        shallowEqual
    )

    const bannerRef = useRef()

    useEffect(() => {
        // åœ¨ç»„ä»¶æŒ‚è½½ä¹‹åå‘é€ç½‘ç»œè¯·æ±‚
        dispatch(getTopBannersAction())
    },[dispatch])
    
    const bgImage =
    topBanners &&
    topBanners[currentIndex] &&
    topBanners[currentIndex].imageUrl + '?imageView&blur=40x20'

    return (
        <BannerWrapper bgImage={bgImage}>
            <div className='content'>
                <BannerLeft>
                    <Carousel
                        effect="fade"
                        autoplay={true}
                        ref={bannerRef}
                        beforeChange={(from, to) => {setCurrentIndex(to)}}
                    >
                        {topBanners && topBanners.map((item)=>(
                            <div key={item.imageUrl}>
                                <img src={item.imageUrl} alt={item.typeTitle}/>
                            </div>
                        ))}
                    </Carousel>
                </BannerLeft>
                <BannerRight/>
                <BannerControl>
                    <button className="btn" onClick={() => bannerRef.current.prev()}></button>
                    <button className="btn" onClick={() => bannerRef.current.next()}></button>
                </BannerControl>
            </div>
        </BannerWrapper>
    );
}

export default TopBanners;
```

#### 3ã€ èƒŒæ™¯é«˜æ–¯æ¨¡ç³Šå®ç°

<img src='./images/11.png'>

### åã€æ¨èé¡µä¸»ä½“å¸ƒå±€

<img src='./images/12.png' width='400'>

- æ ·å¼å®ç°
  - å¤ç”¨å¤´éƒ¨ç»„ä»¶
  - çˆ¶å­ç»„ä»¶ä¹‹é—´propsä¼ å¤´éƒ¨æ•°æ®
  - åœ¨å¤´éƒ¨ç»„ä»¶ä¸­å¯¹å‚æ•°è®¾ç½®è¦æ±‚ï¼ˆtitleå¿…ä¼ ï¼‰

<img src='./images/13.png'>

#### ã€æ³¨æ„ç‚¹ã€‘

- ä½¿ç”¨useSeclectorï¼Œreduceré‡Œä¿®æ”¹stateï¼Œæ˜¯æ›¿æ¢ï¼Œä¸æ˜¯åˆå¹¶

- useSelectoræ€§èƒ½ä¼˜åŒ–ï¼Œç»„ä»¶ä¾èµ–æ•°æ®ä¸å˜æ—¶ä¸é‡å¤æ¸²æŸ“

  

#### 1ã€ç»„ä»¶éœ€è¦å‘é€ç½‘ç»œè¯·æ±‚çš„åŸºæœ¬æ­¥éª¤

- ç½‘ç»œè¯·æ±‚æ¥å£å°è£… src/service/recommend.js

  ```javascript
  // çƒ­é—¨æ¨è 8æ¡
  export function getHotRecommend(){
    return  request({
      url:'/personalized?limit=8'
    })
  }
  ```

- ä¿®æ”¹reducerï¼Œæ·»åŠ æ•°æ®ä»¥åŠactionå¤„ç†å‡½æ•°

  ```javascript
  import * as actionTypes from './actionTypes'
  
  const defaultState = {
      topBanners: [],
      hotRecommend:[]
  }
  
  function reducer(state = defaultState, action){
      switch (action.type) {
          case actionTypes.CHANGE_TOP_BANNER:
              return {
                  ...state,
                  topBanners:action.topBanners.banners
              }
          case actionTypes.CHANGE_HOT_RECOMMEND:
              return {
                  ...state,
                  hotRecommend: action.hotRecommend.result
              }
          default:
              return state
          
      }
  }
  
  export default reducer;
  ```

- åœ¨actionCreatoræ–‡ä»¶ä¸­å‘é€ç½‘ç»œè¯·æ±‚ã€ç”Ÿæˆå¯¹åº”action

  ```javascript
  import * as actionTypes from './actionTypes';
  import {getTopBanners,getHotRecommend} from '@/service/recommend';
  
  // è½®æ’­å›¾Action
  export const changeTopBannerAction = res => ({
      type: actionTypes.CHANGE_TOP_BANNER,
      topBanners: res,
  })
  
  // è½®æ’­å›¾ç½‘ç»œè¯·æ±‚
  export const getTopBannersAction = () => {
      return dispatch => {
        // å‘é€ç½‘ç»œè¯·æ±‚
          getTopBanners().then(res => {
              dispatch(changeTopBannerAction(res))
          })
      }
  }
  
  // çƒ­é—¨æ¨èAction
  export const changeHotRecommendAction = res => ({
      type: actionTypes.CHANGE_HOT_RECOMMEND,
      hotRecommend:res
  })
  
  // çƒ­é—¨æ¨èç½‘ç»œè¯·æ±‚
  export const getHotRecommendAction = ()=>{
      return dispatch => {
          getHotRecommend().then(res => {
              dispatch(changeHotRecommendAction(res))
          })
      }
  }
  ```

- åœ¨ç»„ä»¶ä¸­ä½¿ç”¨useSelectorå±•ç¤ºæ•°æ®

  ```javascript
  function HotRecommend(){
      // console.log('HotRecommendç»„ä»¶æ¸²æŸ“');
  
      // ä»storeä¸­è·å–æ•°æ®
      const {hotRecommend} = useSelector(state => ({
          hotRecommend:state.recommend.hotRecommend
      }),shallowEqual)
  
      const dispatch = useDispatch();
      // ç½‘ç»œè¯·æ±‚æ•°æ®
      useEffect(() => {
          console.log('HotRecommendç»„ä»¶å‘é€ç½‘ç»œè¯·æ±‚');
          dispatch(getHotRecommendAction());
      }, [dispatch])
  
      return (
          <HotRecommendWrapper>
              <ThemeHeaderRmc 
                  title="çƒ­é—¨æ¨è"
                  keywords={['åè¯­', 'æµè¡Œ', 'æ‘‡æ»š', 'æ°‘è°£', 'ç”µå­']}
              />
              <div className="recommend-list">
                  {
                      hotRecommend &&
                      hotRecommend.map((item) => (
                          <SongCover key={item.id} info={item} className='item'/>
                      ))
                  }
              </div>
          </HotRecommendWrapper>
      );
  }
  
  export default HotRecommend;
  ```

  

#### 2ã€å®ç°æ•ˆæœ

å¤–å±‚åŒ…è£¹div, å¹¶ä½¿ç”¨flexå¸ƒå±€, flex-wrapæ¢è¡Œ

<img src='./images/14.png'>

<img src='./images/15.png'>



### åä¸€ã€éŸ³ä¹æ’­æ”¾ç»„ä»¶

#### 1ã€æ ·å¼å®ç°

- è¿›åº¦æ¡å’Œæ–‡å­—æç¤ºä½¿ç”¨äº†antdç»„ä»¶åº“ä¸­çš„Sliderç»„ä»¶å’Œtooltipsç»„ä»¶

- ä¸»ä½“åˆ†ä¸‰éƒ¨åˆ†ï¼Œæœ€å¤–å±‚flexå¸ƒå±€ï¼Œä¸‰éƒ¨åˆ†å†…éƒ¨ä¹Ÿç”¨flexå¸ƒå±€å®ç°

  ```
  PlayBarç»„ä»¶å¸ƒå±€é‡‡ç”¨å›ºå®šå®šä½: 
  PlayerWrapperâ†“
   	å†…å®¹(content)åˆ†äº†ä¸‰ä¸ªéƒ¨åˆ†:â†“
   		1)Control(å·¦ä¾§)
   			ä¸‰ä¸ªæŒ‰é’®.æ·»åŠ èƒŒæ™¯å›¾,å¤–å±‚é‡‡ç”¨flexå¸ƒå±€
   		2)PlayIInfo(ä¸­é—´)
   		3)Opertaor(å³ä¾§)
   			ä¸¤éƒ¨åˆ†,å¤–å±‚é‡‡ç”¨flexå¸ƒå±€
  ```

  

<img src='./images/16.png'>



#### 2ã€æ­Œæ›²è¯¦æƒ…æ’­æ”¾æ•°æ®è¯·æ±‚

- å…ˆå›ºå®šæ’­æ”¾ä¸€é¦–æ­Œï¼Œå›ºå®šæŸ¥è¯¢ids

  http://localhost:4000/song/detail?ids=167874

- å®ç°æ­¥éª¤

  - 1ã€ç½‘ç»œè¯·æ±‚ service/player.js

    ```javascript
    import request from './request';
    
    export function getSongDetail(ids){
        return request({
            url:'/song/detail',
            params:{
                ids
            }
        });
    }
    ```

  - 2ã€åˆ›å»ºå¯¹åº”storeâ€”â€”/pages/player/store

    - actionTypes.js å®šä¹‰å¸¸é‡

      ```javascript
      export const CHANGE_CURRENT_SONG = 'CHANGE_CURRENT_SONG'
      ```

    - reducer.js å®šä¹‰æ•°æ®ä¸actionå¤„ç†å‡½æ•°

      ```javascript
      import * as actionTypes from './actionTypes';
      
      const defaultState = {
          currentSong: {}
      }
      
      function reducer(state=defaultState,action){
          switch(action.type){
              case actionTypes.CHANGE_CURRENT_SONG:
                  return {
                      ...state,
                      currentSong:action.currentSong
                  };
              default:
                  return state;
          }
      }
      
      export default reducer;
      ```

      - åˆ›å»ºaction

      ```javascript
      import * as actionTypes from './actionTypes';
      import {getSongDetail} from '@/service/player';
      
      // æ­Œæ›²è¯¦æƒ…Action
      const changeCurrentSongAction = res =>({
              type:actionTypes.CHANGE_CURRENT_SONG,
              currentSong:res
          })
      
      export const getSongDetailAction = id =>{
          return dispatch => {
              getSongDetail(id).then(res => {
                  dispatch(changeCurrentSongAction(res));
              });
          }
      }
      ```

  - 3ã€åœ¨player/app-player-bar/index.jsé‡Œå¼•ç”¨actionCreatorä¸­çš„æ–¹æ³•å‘é€è¯·æ±‚ã€å…³è”æ•°æ®

  - 4ã€æ›´æ”¹ç»„ä»¶çš„å›ºå®šæ•°æ®

    ```javascript
     currentSong.al.picUrl   å›¾ç‰‡
     currentSong.name 		æ­Œæ›²åå­—
     currentSong.ar[0].name  ä½œè€…
     currentSong.dt  (æ­Œæ›²æ€»æ—¶é•¿,æ ¼å¼åŒ–)
     å¯¼å…¥æ—¶é—´æ ¼å¼åŒ–å·¥å…·(è½¬æ¢æ—¶é—´æ ¼å¼)
     formatDate(duration, "mm:ss")
    ```


#### 3ã€éŸ³ä¹æ’­æ”¾

- æ­Œæ›²è¯¦æƒ…é¡µæ‹¿ä¸åˆ°éŸ³ä¹æ’­æ”¾çš„URLï¼Œéœ€è¦æ ¹æ®IDäºŒæ¬¡è·å–

  -  æ­Œæ›²è¯¦æƒ…API  `/song/detail?ids=167874`

  - éŸ³ä¹æ’­æ”¾url    `song/url?id=167874`

  - æ ¹æ®è¯·æ±‚ä¸‹æ¥`å½“å‰æ­Œæ›²(currentSong)`è·å–å½“å‰æ­Œæ›²`id`ä¿¡æ¯ï¼Œå†å»è¯·æ±‚æ’­æ”¾URL

    ```javascript
        /***** è®¾ç½®éŸ³é¢‘src ****/
        useEffect(()=>{
            console.log('è®¾ç½®éŸ³é¢‘******');
            if(currentSong.id){
                dispatch(getSongPlayUrlAction(currentSong.id));
            }
        },[currentSong]);// eslint-disable-line react-hooks/exhaustive-deps
    ```

- éŸ³ä¹æ’­æ”¾é€»è¾‘

  ```
  step1 
    	æ·»åŠ  audio æ ‡ç­¾ï¼Œè®¾ç½®src
    	æ·»åŠ clickäº‹ä»¶ï¼Œç‚¹å‡»åˆ‡æ¢audioæ’­æ”¾/æš‚åœçŠ¶æ€
    	
  ```

- å®ç°æ•ˆæœ

  <img src='./images/17.png'>

#### 4ã€éŸ³ä¹æ’­æ”¾ä¸æ»‘åŠ¨æ¡è”åŠ¨

- audioæ ‡ç­¾éŸ³ä¹æ’­æ”¾æ—¶è§¦å‘ timeUpdateï¼Œæ›´æ–°currentTimeå’Œprogress
- æ»‘åŠ¨æ»‘å—æ—¶è§¦å‘sliderChangeï¼Œæ›´æ–°currentTimeå’Œprogressã€‚è‹¥æ­Œæ›²åœ¨æ’­æ”¾ï¼Œåˆ™æ­¤æ—¶æœ‰ä¸¤ä¸ªå‡½æ•°å¯¹è¿™ä¸¤ä¸ªå˜é‡æ›´æ”¹ï¼Œæ•…è®¾ç½®isChangingå˜é‡ï¼Œæ§åˆ¶æŸæ—¶åªæœ‰ä¸€ä¸ªå‡½æ•°å¯æ›´æ”¹
- æ‰‹æŒ‡æŠ¬èµ·æ—¶è§¦å‘slideAfterChangeï¼Œã€æ³¨æ„ã€‘è®¾ç½®é‡æ–°è·å–sliderçš„valueï¼Œå¯¹audioçš„currentTimeè®¾ç½®

```javascript
/***** éŸ³ä¹æ’­æ”¾æ—¶æ›´æ–°æ­Œæ›²æ’­æ”¾æ—¶é—´currentTimeã€sliderè¿›ç¨‹ ****/
    function timeUpdate(e){
        // console.log(e.target.currentTime);
        let currentTime = e.target.currentTime;
        if(!isChanging){
            console.log('éŸ³ä¹æ’­æ”¾æ—¶æ›´æ–°æ­Œæ›²æ’­æ”¾æ—¶é—´currentTimeã€sliderè¿›ç¨‹');
            setCurrentTime(currentTime*1000);
            setProgress(((currentTime * 1000) / duration) * 100);   
        }     
    }

    /***** æ»‘åŠ¨æ»‘å—æ—¶è§¦å‘ ****/
    function sliderChange(value){
        console.log('æ»‘åŠ¨æ»‘å—æ—¶æ›´æ–°currentTimeã€sliderè¿›ç¨‹');
        setIsChanging(true);
        const currentTime = (value / 100) * duration;
        setCurrentTime(currentTime);
        setProgress(value);

    }
    /***** æ‰‹æŒ‡æŠ¬èµ·æ—¶è§¦å‘ ****/
    function slideAfterChange(value){
        console.log('æ‰‹æŒ‡æŠ¬èµ·æ—¶æ›´æ–°audioçš„currentTime');
        setIsChanging(false);
        const currentTime = ((value / 100) * duration) / 1000;
        audioRef.current.currentTime = currentTime;
    }
```



```
progressè¿›åº¦: 1-100
currentTime: è¦çš„æ˜¯æ¯«ç§’æ•°
audioRef.current.currentTime: è¦çš„æ˜¯æ€»ç§’æ•°
```

#### 5ã€æ­Œæ›²æ’­æ”¾åŠŸèƒ½å®Œå–„

- æ–°å¢åŠŸèƒ½

  - åˆ‡æ¢åˆ—è¡¨æ’­æ”¾é¡ºåºï¼šéšæœºæ’­æ”¾/é¡ºåºæ’­æ”¾
  - ç‚¹å‡»å·¦å³æŒ‰é’®æ ¹æ®æŒ‡å®šé¡ºåºæ’­æ”¾æ­Œæ›²

- æ–°å¢å­—æ®µ

  - currentSongIndex å½“å‰æ’­æ”¾éŸ³ä¹çš„ç´¢å¼•
  - playList  æ’­æ”¾åˆ—è¡¨
  - playSequence æ’­æ”¾é¡ºåº
  - playListCount æ’­æ”¾åˆ—è¡¨æ•°é‡

- è¯·æ±‚æ­Œæ›²è¯¦æƒ…é€»è¾‘

  ```javascript
  export const getSongDetailAction = (id) =>{
      return (dispatch,getState) => {
          // 1ã€æ ¹æ®idæŸ¥æ‰¾palyListé‡Œæ˜¯å¦æœ‰è¯¥æ­Œæ›²
          const playList = getState().player.playList;
          const songIndex = playList.findIndex(song => song.id===id);
          
          if(songIndex !== -1){
              // 2ã€æ‰¾åˆ°æ­Œæ›²
              dispatch(changeSongIndexAction(songIndex));
              dispatch(changeCurrentSongAction(playList[songIndex]));
              dispatch(changeCurrentSongPlayUrlAction(id));
  
          }else{
              // 3ã€æ²¡æ‰¾åˆ°æ­Œæ›²
              // è¯·æ±‚æ•°æ®
              getSongDetail(id).then(res => {
                  const song = res.songs && res.songs[0];
                  playList.push(song);
                  // (1)æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨ä¸­
                  dispatch(changePlayListAction(playList));
                  let songIndex = playList.length-1;
                  // (2)æ›´æ”¹å½“å‰æ’­æ”¾çš„ç´¢å¼•
                  dispatch(changeSongIndexAction(songIndex));
                  // (3)æ›´æ”¹å½“å‰æ’­æ”¾æ­Œæ›²
                  dispatch(changeCurrentSongAction(playList[songIndex]));
                  // (4)æ›´æ”¹å½“å‰æ’­æ”¾æ­Œæ›²url
                  dispatch(changeCurrentSongPlayUrlAction(id));
                  // (5)æ›´æ–°æ­Œæ›²æ•°é‡
                  dispatch(changePlayListCount(playList.length));
              });
  
          }
      }
  }
  ```

- æ”¹å˜æ’­æ”¾é¡ºåº

  ```javascript
  // æ›´æ”¹æ’­æ”¾é¡ºåºAction
  export const changePlaySequenceAction = (res) => ({
      type: actionTypes.CHANGE_PLAY_SEQUENCE,
      playSequence:res
  })
  ```

- ç‚¹å‡»æŒ‰é’®åˆ‡æ¢æ­Œæ›²

  ```javascript
  // åˆ‡æ¢æ­Œæ›²Action
  export const changeCurrentIndexAndSongAction = (tag) =>{
      return (dispatch,getState) => {
          // æ ¹æ®playSequenceå†³å®šæ˜¯é¡ºåºæ’­æ”¾è¿˜æ˜¯éšæœºæ’­æ”¾
          const playSequence = getState().player.playSequence;
          // æ’­æ”¾åˆ—è¡¨
          const playList = getState().player.playList;
          // å½“å‰æ’­æ”¾çš„ç´¢å¼•/ä¸‹æ ‡
          let currentSongIndex = getState().player.currentSongIndex;
  
          // æ ¹æ®æ’­æ”¾é¡ºåºé€‰æ‹©ä¸‹ä¸€é¦–éŸ³ä¹
          switch(playSequence){
              case 1: 
                  // éšæœºæ’­æ”¾
                  let random = getRandomNumber(playList.length)
                  while (random === currentSongIndex) {
                      random = getRandomNumber(playList.length)
                  }
                  // æ›´æ”¹å½“å‰æ’­æ”¾éŸ³ä¹çš„ä¸‹æ ‡
                  currentSongIndex = random
                  break;
              default:
                  // é¡ºåºæ’­æ”¾
                  currentSongIndex += tag
                  // åˆ¤æ–­å½“å‰éŸ³ä¹çš„ä¸‹æ ‡æ˜¯å¦è¶…å‡ºæ’­æ”¾åˆ—è¡¨é•¿åº¦
                  if (currentSongIndex >= playList.length) currentSongIndex = 0;
                  if (currentSongIndex < 0) currentSongIndex = playList.length - 1;
          }
          // è·å–éœ€è¦æ’­æ”¾çš„éŸ³ä¹
          const song = playList[currentSongIndex];
          // æ›´æ”¹å½“å‰æ’­æ”¾çš„éŸ³ä¹
          dispatch(changeCurrentSongAction(song));
          dispatch(changeSongIndexAction(currentSongIndex))
          dispatch(changeCurrentSongPlayUrlAction(song.id));
      }
  }
  ```

- å®ç°æ•ˆæœ

  <img src='./images/18.png'>

  

  <img src='./images/19.png'>



#### 6ã€æ­Œè¯æ˜¾ç¤º

- æ­Œè¯æ•°æ®æ¥å£API   `http://localhost:4000/lyric?id=167876`

  <img src='./images/20.png'>

- æ­Œè¯è¯·æ±‚æ—¶æœº

  - ç»„ä»¶æ¸²æŸ“å®Œ/åˆ‡æ¢æ­Œæ›²

- æ­Œè¯è§£æ

   å°è£…æ­Œè¯è§£æå·¥å…·å‡½æ•°(é€»è¾‘æ€è·¯)

   ```javascript
   1.ä½¿ç”¨sliceåˆ‡å‰²å­—ç¬¦ä¸²
   2.åˆ›å»ºæ­£åˆ™è§£æè§„åˆ™: å°†"[00:26.810]å‚»ç«™åœ¨ä½ å®¶æ¥¼ä¸‹..."  è§£ææˆ->  00:26.810 
   3.æ³¨æ„: æœ€åä¸€è¡Œä¹Ÿæœ‰\nåœ¨éå†æ—¶åŠ ä¸ªåˆ¤æ–­,å¦‚æœä¸ºä¸ä¸ºç©ºæ‰§è¡Œä¸‹é¢æ“ä½œ
   4.è·å–æ­£åˆ™è§£æçš„3ä¸ªæ—¶é—´è½¬æ¢ä¸ºæ¯«ç§’, åˆ†é’Ÿ:ç§’æ•°:00*10 000å°±æ˜¯æ¯«ç§’(åŠ ä¸ªåˆ¤æ–­*1è½¬æ¢ä¸ºnumberç±»å‹)
   5.å°†è·å–çš„3ä¸ªæ¯«ç§’æ•°ç›¸åŠ : å½“å‰æ­Œæ›²æ’­æ”¾çš„æ€»æ—¶é•¿(æ¯«ç§’)
   6.è·å–å½“å‰æ’­æ”¾çš„æ­Œè¯: replaceæ–¹æ³• (å®Œæˆæ•ˆæœå¦‚ä¸‹ğŸ‘‡)
     [
       0: {totalTime: 0, content: "ä½œæ›² : è®¸åµ©"}
       1: {totalTime: 1000, content: "ä½œè¯ : è®¸åµ©"}
       2: {totalTime: 22240, content: "å¤©ç©ºå¥½æƒ³ä¸‹é›¨"}
       3: {totalTime: 24380, content: "æˆ‘å¥½æƒ³ä½ä½ éš”å£"}
     ]
   7.å°†æ•°æ®ä¿å­˜åˆ°reduxå½“ä¸­
   8.æ³¨æ„: åœ¨åˆ‡æ¢æ­Œæ›²æ—¶æœ‰å¯èƒ½ä¼šæŠ¥ Cannot read property '1' of null , è¿™æ˜¯å› ä¸ºä»resultè¯»å–å±æ€§æ—¶æ²¡æ‰¾åˆ°, åŠ ä¸€ä¸ªifåˆ¤æ–­,å¦‚æœresultæ²¡æœ‰å€¼çš„è¯, æ‰§è¡Œå…³é”®å­—continueè·³è½¬åˆ°åˆ¤æ–­æ¡ä»¶é‡æ–°æ‰§è¡Œ
   ```

   æ­Œè¯è§£æä»£ç 

   ```javascript
   const parseExp = /\[([0-9]{2}):([0-9]{2})\.([0-9]{2,3})\]/
   export function parseLyric(lyrics) {
     if(!lyrics) return
     const lineStrings = lyrics.split('\n')
     const lyricList = []
     for (const line of lineStrings) {
       if (line) {
         const result = parseExp.exec(line)
         if(!result) continue
         const time1 = result[1] * 60 * 1000
         const time2 = result[2] * 1000
         const time3 = result[3].length > 2 ? result[3] * 1 : result[3] * 1000
         // å½“å‰æ­Œæ›²æ’­æ”¾çš„æ€»æ—¶é•¿(æ¯«ç§’)
         const totalTime = time1 + time2 + time3
         const content = line.replace(parseExp, '').trim()
         const lineObj = {totalTime, content};
         lyricList.push(lineObj)
       }
     }
     return lyricList
   }
   ```

- è§£æç»“æœå­˜å‚¨åœ¨ lyricListä¸­

   <img src='./images/21.png'>

- æ‰¾åˆ°å½“å‰æ—¶åˆ»å¯¹åº”çš„æ­Œè¯

   åœ¨å‡½æ•°`timeUpdate`é‡Œå¤„ç†

   - å½“å‰æ’­æ”¾æ—¶é—´å°äºæ­Œè¯æ—¶é—´ï¼Œé€€å‡ºå¾ªç¯ï¼Œå–å‰ä¸€å¥æ­Œè¯
   - æ›´æ”¹å½“å‰æ­Œè¯ç´¢å¼•æ—¶è¿›è¡Œåˆ¤æ–­ï¼Œé¿å…ä¸å¿…è¦çš„dispatch

   ```javascript
    	function timeUpdate(e){
           let currentTime = e.target.currentTime;
           if(!isChanging){
               // console.log('éŸ³ä¹æ’­æ”¾æ—¶æ›´æ–°æ­Œæ›²æ’­æ”¾æ—¶é—´currentTimeã€sliderè¿›ç¨‹');
               setCurrentTime(currentTime*1000);
               setProgress(((currentTime * 1000) / duration) * 100);   
           }     
   
           // è·å–å½“å‰æ’­æ”¾æ­Œè¯
           let i = 0; //ç”¨äºè·å–æ­Œè¯çš„ç´¢å¼•
           for (; i < lyricList.length; i++){
               if (currentTime * 1000 < lyricList[i].totalTime) {
                   break;
               }
           }
           // å¦‚æœindexæ²¡æœ‰æ”¹å˜,å°±ä¸è¿›è¡Œdispatch(å¯¹dispatchè¿›è¡Œä¼˜åŒ–)
           if (currentLyricIndex !== i - 1) {
               dispatch(changeCurrentLyricIndexAction(i - 1));
           }
           console.log(lyricList[i-1]);
       }
   ```

   <img src='./images/22.png'>

   

- å±•ç¤ºæ­Œè¯

   - ä½¿ç”¨`Antd Message`ç»„ä»¶
   - `Message`ç»„ä»¶çš„å¼€å¯å’Œé”€æ¯
     - å’ŒisPlayingç›¸å…³è”ï¼Œå½“isPlayingä¸ºfalseæ—¶é”€æ¯ï¼ŒisPlayingä¸ºtrueæ—¶å¼€å¯
   - å®ç°æ•ˆæœ
   
   <img src='./images/23.png'>





### åäºŒã€æœç´¢æ å®ç°

#### 1ã€å‘é€ç½‘ç»œè¯·æ±‚

- service/theme-header.jså°è£…ç½‘ç»œè¯·æ±‚

  ```javascript
  import request from './request';
  
  export function getSearchSongData(keywords,limit=6,type=1){
      return request({
          url:'/search',
          params:{
              keywords,
              limit,
              type
          }
      });
  }
  ```

- åˆ›å»ºreducerå’ŒactionCreators

  ```javascript
  // reducer.js
  const defaultState = {
      searchSongList: [],
      focusState: false
  };
  ```

#### 2ã€å®šä¹‰Inputç»„ä»¶çš„äº‹ä»¶å¤„ç†å‡½æ•°

- ä½¿ç”¨`useCallback`å®šä¹‰

  - é—®é¢˜â€”â€”ç»„ä»¶é‡æ–° render ä¹‹åæ‰€æœ‰çš„äº‹ä»¶å¤„ç†å‡½æ•°é‡æ–°å…¨éƒ¨å®šä¹‰, éå¸¸æµªè´¹æ€§èƒ½
  - è§£å†³: å½“**ä¾èµ–çš„å±æ€§æ²¡æœ‰æ”¹å˜æ—¶**, ä¸å¸Œæœ›æ›´æ–° render æ—¶, **é‡æ–°å®šä¹‰äº‹ä»¶å‡½æ•°**
  - ç›®æ ‡ï¼šä¸ºäº†è¿›è¡Œæ€§èƒ½çš„ä¼˜åŒ–
    - `useCallBack`ä¼šè¿”å›ä¸€ä¸ªå‡½æ•° `memoized`(è®°å¿†çš„) å€¼
    - åœ¨ä¾èµ–ä¸å˜çš„æƒ…å†µä¸‹, å¤šå®šä¹‰çš„æ—¶å€™, è¿”å›å€¼æ˜¯ç›¸åŒçš„

- onChange

  - åŠŸèƒ½ï¼šå‘é€ç½‘ç»œè¯·æ±‚

  - å®ç°æ•ˆæœ

    <img src='./images/24.png' width='700'>

- onFouces

  - åŠŸèƒ½ï¼šæ˜¾ç¤º/éšè—ä¸‹æ‹‰æ¡†
  - 

- onInput

  





é¡¹ç›®éš¾ç‚¹ï¼šåº•éƒ¨éŸ³ä¹æ’­æ”¾å™¨å®ç°

- é€»è¾‘
- ä¼˜åŒ–





åŠ è½½æ€§èƒ½

æ¸²æŸ“æ¬¡æ•°

æ•°æ®å­˜å‚¨/æ›´æ–°

å†…å­˜å æœ‰



